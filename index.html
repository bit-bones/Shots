<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shots</title>
    <style>
        html, body { height: 100%; margin: 0; overflow: hidden; }
        body { background: #181c23; display: flex; justify-content: center; align-items: center; }
        canvas { background: #232832; display: block; border: 2px solid #333; }
        #card-choices {
            position: absolute;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
        }
        #card-choices {
            display: none;
            background: rgba(24,28,35,0.97);
            border-radius: 22px;
            box-shadow: 0 8px 32px #000c, 0 1.5px 0 #65c6ff inset;
            padding: 38px 38px 32px 38px;
            min-width: 700px;
            min-height: 260px;
            flex-direction: row;
            justify-content: center;
            align-items: flex-end;
            gap: 0px;
        }
        #card-choices-info {
            position: absolute;
            left: 50%;
            top: calc(50% + 190px);
            transform: translateX(-50%);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-family: inherit;
            color: #e6f2ff;
            font-size: 1.08rem;
            letter-spacing: 0.4px;
            pointer-events: none;
            z-index: 21;
            text-align: center;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
        }
        #card-choices-info .card-choice-line {
            margin: 0;
            font-weight: 700;
            font-size: 1em;
        }
        #card-choices-info .card-chooser-name {
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0,0,0,0.4);
        }
        #card-choices-info .card-choice-subline {
            margin: 0;
            font-size: 0.96em;
            color: #a3b8d8;
            font-weight: 500;
        }
        .card {
            --rarity-color: #4a5568;
            --rarity-color-soft: rgba(74, 85, 104, 0.2);
            --rarity-color-glow: rgba(74, 85, 104, 0.35);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
            background: linear-gradient(168deg, #1d222c 0%, #252d38 100%);
            border: 2.5px solid #2f3542;
            color: #fff;
            border-radius: 18px 18px 24px 24px;
            font-family: inherit;
            font-size: 1.05em;
            text-align: left;
            padding: 20px 18px 18px 18px;
            gap: 12px;
            cursor: pointer;
            box-shadow: 0 2px 16px #0007;
            position: relative;
            z-index: 1;
            transition: transform 0.22s cubic-bezier(.4,2,.6,1), box-shadow 0.18s, border 0.13s, color 0.13s;
            overflow: hidden;
        }
        .card.card-uniform {
            width: 170px !important;
            height: 240px !important;
            min-width: 0;
            min-height: 0;
            margin: 0;
        }
        .card:hover, .card.selected {
            border: 2.5px solid #65c6ff;
            box-shadow: 0 8px 32px #65c6ff44, 0 2px 24px #000a;
            background: linear-gradient(160deg, #232832 60%, #292f3a 100%);
            z-index: 2;
        }
        .card.centered {
            border: 2.5px solid #56ff7a !important;
            background: linear-gradient(160deg, #1e2a1e 60%, #232832 100%) !important;
            box-shadow: 0 12px 40px #56ff7a55, 0 2px 24px #000a;
            z-index: 10 !important;
            /* transform handled inline for smooth animation */
        }
        .card:hover .card-header b,
        .card.selected .card-header b {
            color: #65c6ff;
        }
        .card.centered .card-header b {
            color: #56ff7a !important;
        }
        .card {
            transition: transform 0.22s cubic-bezier(.4,2,.6,1), box-shadow 0.18s, border 0.13s, color 0.13s;
        }
        .card .card-body {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 0;
            flex: 1;
        }
        .card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 12px;
        }
        .card .card-header b {
            font-size: 1.16em;
            letter-spacing: 0.5px;
        }
        .card .card-rarity-label {
            font-size: 0.62em;
            letter-spacing: 0.48px;
            text-transform: uppercase;
            padding: 2px 6px 1px 6px;
            border-radius: 999px;
            border: 1px solid currentColor;
            background: rgba(20, 24, 32, 0.78);
            opacity: 0.9;
        }
        .card .card-lines {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: auto;
        }
        .card .card-line {
            font-size: 0.98em;
            letter-spacing: 0.2px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .card .card-line::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.9;
        }
        .card .card-line-positive {
            color: #56ff7a;
        }
        .card .card-line-negative {
            color: #ff6b6b;
        }
        .card .card-line-neutral {
            color: #b7c4d9;
        }
        .card .card-line.card-line-neutral::before {
            opacity: 0.4;
        }
        .card .card-line.card-line-positive::before,
        .card .card-line.card-line-negative::before {
            opacity: 0.8;
        }
        .card .card-rarity-trim {
            position: absolute;
            inset: 0;
            border-radius: 18px 18px 24px 24px;
            pointer-events: none;
            background: linear-gradient(180deg, transparent 0%, var(--rarity-color-soft) 100%);
        }
        .card::after {
            content: '';
            display: block;
            position: absolute;
            left: 50%;
            bottom: 10px;
            width: 60%;
            height: 8px;
            background: radial-gradient(ellipse at center, var(--rarity-color-glow) 0%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
            transform: translateX(-50%) scaleY(0.7);
            opacity: 0.7;
            pointer-events: none;
        }

        #roster-panel {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            background: rgba(24,28,35,0.98);
            border-radius: 16px;
            box-shadow: 0 6px 28px #000b;
            border: 2px solid rgba(101,198,255,0.35);
            padding: 20px 18px 18px 18px;
            min-width: 220px;
            max-width: 240px;
            color: #e6f2ff;
            font-family: inherit;
        }
        /* Keep the session display pinned to the bottom of the roster panel */
        #roster-panel #mp-session-row {
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid rgba(101,198,255,0.06);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        #mp-session-copy {
            transition: background 0.12s, transform 0.12s;
            font-size: 0.85em;
        }
        #mp-session-copy.copied {
            background: #28a745 !important;
            transform: scale(0.96);
        }
        /* Keep copy button hidden until session is visible (it will be displayed by setMpSessionDisplay)
           This prevents it appearing before a host session is created. */
        #mp-session-copy { display: none; }
        #mp-session-row[style*="display: block"] #mp-session-copy { display: inline-block; }
        #roster-panel h3 {
            margin: 0 0 12px 0;
            font-size: 1.1rem;
            color: #65c6ff;
            text-align: left;
            letter-spacing: 0.6px;
        }
        #setup-overlay {
            flex-direction: column;
            align-items: center;
            background: rgba(25,28,32,0.99);
            border-radius: 18px;
            box-shadow: 0 4px 32px #000c;
            padding: 32px 44px 34px 44px;
            min-width: 330px;
            max-width: 430px;
            width: 390px;
        }
        #setup-overlay h2 {
            color: #65c6ff;
            margin-bottom: 10px;
        }
        #setup-overlay label {
            color: #fff;
            font-size: 1em;
            margin-bottom: 2px;
            display: block;
        }
        #setup-overlay input[type=range] {
            width: 220px;
        }
        #setup-overlay .setup-row {
            margin-bottom: 18px;
            width: 100%;
        }
        #setup-overlay .slider-value {
            color: #ffda72;
            margin-left: 10px;
        }
        #setup-overlay button {
            background: #65c6ff;
            color: #181c23;
            border: none;
            border-radius: 8px;
            padding: 10px 28px;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 14px;
            cursor: pointer;
            transition: background 0.12s;
        }
        #setup-overlay button:hover {
            background: #56ff7a;
        }
        #setup-overlay .desc {
            color: #b7b7b7;
            font-size: 0.95em;
            margin-bottom: 16px;
            margin-top: -6px;
        }
        #mode-description {
            color: #a9b7d0;
            font-size: 0.92rem;
            margin-bottom: 14px;
            line-height: 1.4;
            min-height: 0;
        }
        #mode-settings {
            width: 100%;
            margin-bottom: 18px;
        }
        #mode-settings:empty {
            display: none;
        }
        .mode-setting-entry {
            margin-bottom: 12px;
        }
        .mode-setting-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 4px;
            color: #e6f2ff;
            font-size: 0.95rem;
        }
        .mode-setting-value {
            color: #ffda72;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        .mode-setting-input {
            width: 100%;
        }
        .mode-setting-desc {
            font-size: 0.82rem;
            color: #8894a8;
            margin-top: 4px;
        }
        /* CARD BADGES UI */
        #cards-ui {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 10px;
            z-index: 10;
            pointer-events: none;
            min-width: 450px;
            font-family: sans-serif;
        }
        .cards-list {
            margin-bottom: 0;
            white-space: nowrap;
        }
        .card-badge {
            display: inline-block;
            background: rgba(41, 47, 58, 0.9);
            border: 1.2px solid #3d4351;
            border-radius: 6px;
            color: #ffffff;
            font-size: 0.98em;
            margin: 0 2px 0 2px;
            padding: 3px 10px 2px 10px;
            min-width: 32px;
            min-height: 18px;
            vertical-align: middle;
        }
        .card-badge.none {
            background: #383e47;
            color: #bbb;
            border: 1.2px solid #444;
        }
        .card-badge[title]:hover {
            border: 1.2px solid #65c6ff;
            background: #232832;
            color: #65c6ff;
            z-index: 20;
        }

        /* Roster panel styles */
        .roster-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        .roster-slot {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1.5px solid #3d4351;
            background: linear-gradient(155deg, #1f232b 0%, #252a34 100%);
            color: #e6f2ff;
            min-height: 72px;
            cursor: pointer;
            transition: border 0.18s ease, transform 0.15s ease;
            position: relative;
            width: 100%;
            text-align: left;
            outline: none;
            box-shadow: none;
            appearance: none;
            -webkit-appearance: none;
        }
        .roster-slot:hover:not(:disabled) {
            border-color: #65c6ff;
            transform: translateY(-2px);
        }
        .roster-slot:disabled {
            cursor: default;
            opacity: 0.92;
        }
        .roster-slot:disabled:hover {
            border-color: #3d4351;
            transform: none;
        }
        .roster-slot.selected {
            border-color: #56ff7a;
            box-shadow: 0 8px 24px #56ff7a33;
        }
        .roster-slot .slot-title {
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #87bdfd;
        }
        .roster-slot .slot-body {
            font-size: 0.95rem;
            font-weight: 600;
        }
        .roster-slot .slot-subtext {
            font-size: 0.8rem;
            color: #a9b7d0;
            margin-top: 2px;
        }
        .slot-team-label {
            font-size: 0.78rem;
            font-weight: 700;
            letter-spacing: 0.6px;
            text-transform: uppercase;
            color: #ffd86b;
            margin-bottom: 6px;
        }
        .roster-slot.ready {
            border-color: #56ff7a;
            box-shadow: 0 0 0 2px rgba(86, 255, 122, 0.35);
        }
        .ready-indicator {
            position: absolute;
            right: 8px;
            bottom: 8px;
            min-width: 46px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.62rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(86, 255, 122, 0.18);
            color: #56ff7a;
            border: 1px solid rgba(86, 255, 122, 0.6);
            font-weight: 600;
        }
        .bot-difficulty-indicator {
            position: absolute;
            right: 8px;
            bottom: 8px;
            min-width: 46px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.62rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            background: rgba(145, 160, 255, 0.12);
            color: #b7c5ff;
            border: 1px solid rgba(145, 160, 255, 0.45);
        }
        .bot-difficulty-indicator.bot-difficulty-easy {
            background: rgba(123, 208, 125, 0.18);
            color: #72da7c;
            border-color: rgba(123, 208, 125, 0.45);
        }
        .bot-difficulty-indicator.bot-difficulty-normal {
            background: rgba(145, 160, 255, 0.18);
            color: #9ba7ff;
            border-color: rgba(145, 160, 255, 0.5);
        }
        .bot-difficulty-indicator.bot-difficulty-hard {
            background: rgba(255, 134, 103, 0.2);
            color: #ff8b6c;
            border-color: rgba(255, 134, 103, 0.55);
        }
        .roster-slot .slot-actions {
            display: none;
        }
        .roster-cursor-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            opacity: 0.75;
            pointer-events: none;
        }
        .roster-cursor-icon svg {
            width: 100%;
            height: 100%;
        }
        .roster-context-menu {
            position: fixed;
            background: #11161f;
            border: 1px solid #2f3440;
            border-radius: 8px;
            box-shadow: 0 10px 28px rgba(0, 0, 0, 0.55);
            padding: 6px 0;
            z-index: 5000;
            min-width: 150px;
            color: #ddebff;
            font-size: 0.82rem;
            letter-spacing: 0.25px;
        }
        .roster-context-item {
            padding: 6px 14px;
            cursor: pointer;
            user-select: none;
            transition: background 0.12s ease, color 0.12s ease;
        }
        .roster-context-item.disabled {
            cursor: default;
            opacity: 0.55;
            pointer-events: none;
        }
        .roster-context-item:hover {
            background: #2f8bff;
            color: #0e1420;
        }
        .roster-context-item.active {
            background: #2f8bff;
            color: #0e1420;
        }
        .roster-context-item.has-submenu::after {
            content: '›';
            float: right;
            color: #5f6b7f;
            font-weight: 600;
        }
        .roster-context-submenu {
            position: absolute;
            left: 100%;
            top: 0;
            background: #10151d;
            border: 1px solid #2f3440;
            border-radius: 8px;
            box-shadow: 0 10px 28px rgba(0, 0, 0, 0.55);
            min-width: 140px;
            padding: 6px 0;
            z-index: 5001;
        }
        .roster-context-submenu .roster-context-item {
            padding: 6px 14px;
            white-space: nowrap;
        }
        .roster-inline-rename {
            width: 100%;
            padding: 4px 6px;
            border-radius: 6px;
            border: 1px solid #65c6ff;
            background: rgba(31, 35, 43, 0.95);
            color: #e6f2ff;
            font-size: 0.9rem;
            font-weight: 600;
            outline: none;
            box-sizing: border-box;
        }
        .roster-inline-rename:focus {
            border-color: #ffd86b;
        }
        .roster-note {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #b7b7b7;
            line-height: 1.35;
        }

        /* Info badge styles */
        .setting-row {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        .setting-help {
            display: inline-flex;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3a4050;
            color: #cfd8e3;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 8px;
            margin-left: 0;
            cursor: default;
            border: 1px solid #2f3440;
            position: relative;
        }
        .setting-help[title]:hover::after {
            content: attr(title);
            position: absolute;
            background: #13161a;
            color: #d8e9ff;
            padding: 8px 10px;
            border-radius: 8px;
            box-shadow: 0 6px 20px #0008;
            transform: translateY(-8px);
            white-space: nowrap;
            font-size: 12px;
            left: 50%;
            top: -38px;
            z-index: 60;
        }
        .card-deck-btn {
            padding: 14px 8px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.12s ease, filter 0.12s ease;
            user-select: none;
            border: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(28, 33, 41, 0.8);
            color: #dae6f5;
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.2);
        }
        .card-deck-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
        }
        .card-deck-btn:active {
            transform: translateY(0);
            filter: brightness(1.08);
        }
        /* Game wrapper so we can anchor elements relative to the canvas */
        #game-wrapper {
            position: relative;
            display: inline-block;
        }

        /* Bottom world cards line anchored under the canvas */
        #world-cards-bottom {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: calc(100% + 12px);
            z-index: 10;
            pointer-events: none;
            min-width: 450px;
            font-family: sans-serif;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <canvas id="game" width="1300" height="650"></canvas>
        <div id="world-cards-bottom"></div>
    </div>
    <div id="card-choices"></div>
    
    <div id="setup-wrapper" style="display: flex; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 20; align-items: stretch; gap: 24px;">
        <div id="roster-panel" style="display: flex; flex-direction: column; align-items: stretch; background: rgba(24,28,35,0.98); border-radius: 16px; box-shadow: 0 6px 28px #000b; border: 2px solid rgba(101,198,255,0.35); padding: 20px 18px 18px 18px; min-width: 220px; max-width: 240px; color: #e6f2ff; font-family: inherit;">
            <h3 style="margin: 0 0 12px 0; font-size: 1.1rem; color: #65c6ff; text-align: left; letter-spacing: 0.6px;">Roster</h3>
            <div id="roster-grid" class="roster-grid">
                <button class="roster-slot empty" data-slot="0" type="button">
                    <span class="slot-title">Slot 1</span>
                    <span class="slot-body">Empty seat</span>
                    <span class="slot-subtext">Click to add AI bot</span>
                    <div class="slot-actions"></div>
                </button>
                <button class="roster-slot empty" data-slot="1" type="button">
                    <span class="slot-title">Slot 2</span>
                    <span class="slot-body">Empty seat</span>
                    <span class="slot-subtext">Click to add AI bot</span>
                    <div class="slot-actions"></div>
                </button>
                <button class="roster-slot empty" data-slot="2" type="button">
                    <span class="slot-title">Slot 3</span>
                    <span class="slot-body">Empty seat</span>
                    <span class="slot-subtext">Click to add AI bot</span>
                    <div class="slot-actions"></div>
                </button>
                <button class="roster-slot empty" data-slot="3" type="button">
                    <span class="slot-title">Slot 4</span>
                    <span class="slot-body">Empty seat</span>
                    <span class="slot-subtext">Click to add AI bot</span>
                    <div class="slot-actions"></div>
                </button>
            </div>
            <div id="roster-note" class="roster-note">Click a slot to add or remove an AI bot. Remote players occupy the next empty seat.</div>
            <!-- Session display: shows current session code when hosting or joined -->
            <div id="mp-session-row" style="display:none; color:#b7e6ff; font-size:0.95em;">
                <div id="mp-session-row-inner" style="display:flex; align-items:center; gap:8px; white-space:nowrap;">
                    <span>Session: <span id="mp-session-label" style="font-weight:700; color:#fff; margin-left:6px;"></span></span>
                    <button id="mp-session-copy" title="Copy invite link" style="background:#2f8bff; color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; font-weight:700; margin-left:auto;">Copy</button>
                </div>
            </div>
        </div>
        <div id="setup-overlay">
            <h2>Game Setup</h2>
        <div class="desc">Shots</div>
        <div class="setup-row">
            <label for="game-mode-select">Game Mode:</label>
            <select id="game-mode-select">
                <option value="">Loading...</option>
            </select>
        </div>
        <div id="mode-description"></div>
        <div id="mode-settings"></div>
        <div class="setup-row">
            <label for="obstacle-density">Obstacle Density:</label>
            <input type="range" id="obstacle-density" min="2" max="15" value="7">
            <span id="density-value" class="slider-value">7</span>
        </div>
        <div class="setup-row">
            <label for="obstacle-size">Obstacle Size:</label>
            <input type="range" id="obstacle-size" min="40" max="200" value="110">
            <span id="size-value" class="slider-value">110</span>
        </div>
        <div class="setup-row">
            <label for="rounds-to-win">Rounds to Win:</label>
            <input type="number" id="rounds-to-win" min="1" max="50" value="10" style="width:80px;">
        </div>
        <div class="setup-row">
            <div class="setting-row">
                <div class="setting-help" title="When on, every fighter draws a PowerUp before the first round begins.">i</div>
                <label for="choose-card-on-start" style="margin-bottom:0;">Choose card on start:</label>
                <input type="checkbox" id="choose-card-on-start" checked>
            </div>
        </div>
        <div class="setup-row">
            <div class="setting-row">
                <div class="setting-help" title="When on, bullets will bounce off the edges instead of leaving the play area.">i</div>
                <label for="map-border" style="margin-bottom:0;">Map Border:</label>
                <input type="checkbox" id="map-border" checked>
            </div>
        </div>
        <!-- Enemy AI setting removed (roster system manages AI/bots) -->
        <div class="setup-row">
            <label for="saved-maps">Saved Map:</label>
            <select id="saved-maps">
                <option value="">(none)</option>
            </select>
            <button id="delete-saved-map" style="margin-left:8px;">Delete</button>
            <button id="open-map-editor" style="margin-left:6px;">Map Editor</button>
        </div>
        
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <button id="manage-powerups-btn">PowerUp Cards</button>
            <button id="manage-worldmods-btn">World Mod Cards</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <button id="start-button">Start Game</button>
            <button id="open-options-btn">Options</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button id="host-btn">Host / Invite</button>
            <button id="join-btn">Join Game</button>
        </div>
        </div>
    </div>
    <div id="cards-ui"></div>

    <!-- Multiplayer Modal -->
    <div id="multiplayer-modal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; z-index:3000; background:rgba(0,0,0,0.55); align-items:center; justify-content:center;">
        <div style="background:#232832; border-radius:14px; padding:32px 32px 24px 32px; min-width:340px; max-width:90vw; margin:auto; box-shadow:0 8px 40px #000a; color:#fff; display:flex; flex-direction:column; align-items:center;">
            <div id="mp-host-section" style="display:none; flex-direction:column; align-items:center;">
                <h3 style="color:#65c6ff; margin-bottom:10px;">Invite a Friend</h3>
                <div style="margin-bottom:10px;">Share this code or link:</div>
                <input id="mp-session-code" type="text" maxlength="10" readonly style="font-size:1.2em; text-align:center; margin-bottom:10px; width:180px; background:#181c23; color:#65c6ff; border:1.5px solid #65c6ff; border-radius:7px; padding:6px 10px; cursor:text;" />
                <button id="mp-copy-link" style="margin-bottom:10px; padding:6px 10px; border-radius:7px; background:#65c6ff; color:#181c23; border:none; cursor:pointer; font-weight:700;">Copy Link</button>
                <div style="font-size:0.98em; color:#b7e6ff; margin-bottom:10px;">Waiting for player to join...</div>
            </div>
            <div id="mp-join-section" style="display:none; flex-direction:column; align-items:center;">
                <h3 style="color:#65c6ff; margin-bottom:10px;">Join a Game</h3>
                <div style="margin-bottom:10px;">Enter code or paste invite link:</div>
                <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px;">
                    <input id="mp-join-code" style="font-size:1.2em; text-align:center; width:180px; background:#181c23; color:#65c6ff; border:1.5px solid #65c6ff; border-radius:7px; padding:6px 10px;" />
                </div>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button id="mp-join-confirm" style="margin-bottom:10px; padding:6px 10px; border-radius:7px; background:#65c6ff; color:#181c23; border:none; cursor:pointer; font-weight:700;">Join</button>
                    <button id="mp-paste" style="padding:6px 10px; border-radius:7px; background:#65c6ff; color:#181c23; border:none; cursor:pointer;">Paste</button>
                </div>
            </div>
            <button id="mp-close" style="margin-top:8px; padding:6px 10px; border-radius:7px; background:#3d4351; color:#fff; border:none; cursor:pointer;">Close</button>
        </div>
    </div>

    <!-- Options Modal -->
    <div id="options-overlay" style="display:none; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:2100;">
        <div style="background:rgba(25,28,32,0.99); border-radius:12px; padding:20px 22px; width:360px; box-shadow:0 8px 40px #000a; color:#fff;">
            <h3 style="margin:4px 0 10px 0; color:#65c6ff;">Options</h3>
            <div style="margin-bottom:10px;"><label style="display:block;">Master Volume: <span id="master-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="master-vol" type="range" min="0" max="100" value="100" style="width:100%;" /></div>
            <div style="margin-bottom:10px;"><label style="display:block;">Music Volume: <span id="music-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="music-vol" type="range" min="0" max="100" value="100" style="width:100%;" /></div>
            <div style="margin-bottom:12px;"><label style="display:block;">SFX Volume: <span id="sfx-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="sfx-vol" type="range" min="0" max="100" value="100" style="width:100%;" /></div>
            <div style="margin-bottom:8px; font-size:0.95em; color:#cfd8e3;">Per-effect volumes</div>
            <div style="margin-bottom:8px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Shot Volume: <span id="shot-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="shot-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-shot" title="Preview Shot" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:8px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Explosion Volume: <span id="explosion-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="explosion-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-explosion" title="Preview Explosion" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:8px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Ricochet Volume: <span id="ricochet-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="ricochet-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-ricochet" title="Preview Ricochet" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:12px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Hit Volume: <span id="hit-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="hit-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-hit" title="Preview Hit" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:12px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Dash Volume: <span id="dash-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="dash-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-dash" title="Preview Dash" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:12px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Impact Volume: <span id="impact-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="impact-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-impact" title="Preview Impact" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-bottom:18px; display:flex; align-items:center; gap:8px;"><div style="flex:1 1 0;">
                <label style="display:block;">Burning Volume: <span id="burning-vol-val" style="color:#ffda72; margin-left:8px;">100</span></label>
                <input id="burning-vol" type="range" min="0" max="100" value="100" style="width:100%;" />
                </div>
                <button class="sfx-preview" id="preview-burning" title="Preview Burning" style="width:30px; height:24px;">▶</button>
            </div>
            <div style="margin-top:10px; font-size:0.95em; color:#cfd8e3;">
                <label style="display:block; margin-bottom:6px;">Cursor Style:</label>
                <select id="cursor-style" style="width:100%; padding:6px; background:#13161a; color:#fff; border:1px solid #2f3440; border-radius:6px;">
                    <option value="reticle">Reticle (default)</option>
                    <option value="crosshair">Crosshair</option>
                    <option value="dot">Dot</option>
                    <option value="bigdot">Big Dot</option>
                    <option value="scope">Scope</option>
                    <option value="none">None (system)</option>
                </select>
            </div>
            <div style="margin-top:8px; margin-bottom:10px; font-size:0.95em; color:#cfd8e3;">
                <label style="display:block; margin-bottom:6px;">Cursor Color:</label>
                <input id="cursor-color" type="color" value="#ffd86b" style="width:100%; height:34px; border-radius:6px; border:1px solid #2f3440; background:#13161a;" />
            </div>
            <div style="margin-top:16px; margin-bottom:12px; font-size:0.95em; color:#cfd8e3;">
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                    <input id="blood-effects-toggle" type="checkbox" style="width:18px; height:18px; cursor:pointer;" />
                    <span>Blood Effects (death animation)</span>
                </label>
            </div>
            <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="options-back-btn">Back</button>
            </div>
        </div>
    </div>

    <!-- PowerUp Card Management Modal -->
    <div id="powerup-modal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; z-index:2100; background:rgba(0,0,0,0.6); align-items:center; justify-content:center;">
        <div style="background:#222; padding:24px 32px; border-radius:16px; width:520px; max-width:92%; margin:60px auto; box-shadow:0 4px 32px rgba(0,0,0,0.7); position:relative;">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
                <h3 style="margin:0; color:#fff; font-size:1.3em; font-weight:bold;">PowerUp Cards <span id="powerup-count" style="font-size:0.85em; font-weight:600; opacity:0.85;"></span></h3>
            </div>
            <div id="powerup-card-list" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-bottom:18px; max-height:360px; overflow-y:auto; padding-right:6px; align-content:start;"></div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button id="powerup-enable-all" style="padding:6px 14px; background:#2f8bff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Enable All</button>
                <button id="powerup-disable-all" style="padding:6px 14px; background:#3d4351; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Disable All</button>
                <button id="powerup-modal-close" style="padding:6px 18px; background:#65c6ff; color:#222; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Close</button>
            </div>
        </div>
    </div>

    <!-- World Modifier Card Management Modal -->
    <div id="worldmod-modal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; z-index:2100; background:rgba(0,0,0,0.6); align-items:center; justify-content:center;">
        <div style="background:#222; padding:24px 32px; border-radius:16px; width:520px; max-width:92%; margin:60px auto; box-shadow:0 4px 32px rgba(0,0,0,0.7); position:relative;">
            <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:12px; gap:18px;">
                <h3 style="margin:0; color:#fff; font-size:1.3em; font-weight:bold;">World Modifier Cards <span id="worldmod-count" style="font-size:0.85em; font-weight:600; opacity:0.85;"></span></h3>
                <div id="worldmod-interval-control" style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
                    <div style="display:flex; align-items:center; gap:6px; color:#d8e9ff; font-size:0.88rem;">
                        <div class="setting-help" title="How many rounds between world modifier selections. World modifiers affect the entire game environment." style="margin:0;">i</div>
                        <label for="world-modifier-interval" style="margin:0; color:#d8e9ff; font-weight:600;">Interval: <span id="world-modifier-value" class="slider-value" style="margin-left:6px;">3</span></label>
                    </div>
                    <input type="range" id="world-modifier-interval" min="1" max="10" value="3" style="width:170px;">
                </div>
            </div>
            <div id="worldmod-card-list" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-bottom:18px;"></div>
            <div style="display:flex; gap:10px; justify-content:flex-end;">
                <button id="worldmod-enable-all" style="padding:6px 14px; background:#2f8bff; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Enable All</button>
                <button id="worldmod-disable-all" style="padding:6px 14px; background:#3d4351; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Disable All</button>
                <button id="worldmod-modal-close" style="padding:6px 18px; background:#65c6ff; color:#222; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Close</button>
            </div>
        </div>
    </div>

    <!-- Dev Console (always visible, bottom of screen) -->
    <div id="dev-console-fixed" class="hidden">
        <div id="dev-console-log" tabindex="0"></div>
    <form id="dev-console-form" autocomplete="off">
            <input id="dev-console-input" type="text" placeholder="Type //Card Name or //Card Name/xN..." autocomplete="off" spellcheck="false" />
        </form>
    </div>

    <!-- Map Editor Modal -->
    <div id="map-editor-modal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; z-index:2000; background:rgba(0,0,0,0.6); align-items:center; justify-content:center;">
        <div style="background:#1f2329; padding:14px; border-radius:8px; width:940px; max-width:95%; display:flex; gap:12px;">
            <div style="flex:1 1 0;">
                <canvas id="map-editor-canvas" width="780" height="420" style="background:#2a2f36; display:block; border:1px solid #3b424a;"></canvas>
            </div>
            <div style="width:200px; color:#ddd;">
                <h3 style="margin:6px 0 8px 0; color:#fff; font-size:16px;">Map Editor</h3>
                <label>Square Size: <span id="editor-size-val">80</span></label>
                <input id="editor-size" type="range" min="24" max="220" value="80" style="width:100%;" />
                <div style="margin-top:8px; display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="editor-grid-snap" />
                    <label for="editor-grid-snap" style="margin:0;">Grid Snap</label>
                </div>
                <div style="margin-top:8px;">
                    <button id="editor-place" style="width:100%; margin-bottom:6px;">Place Mode</button>
                    <button id="editor-erase" style="width:100%; margin-bottom:6px;">Erase Mode</button>
                </div>
                <div style="margin-top:8px;">
                    <input id="editor-map-name" placeholder="Map name" style="width:100%; padding:6px; background:#222; color:#fff; border:1px solid #3b424a;" />
                    <button id="editor-save" style="width:100%; margin-top:6px;">Save Map</button>
                    <button id="editor-clear" style="width:100%; margin-top:6px;">Clear</button>
                </div>
                <div style="margin-top:10px;">
                    <button id="editor-close" style="width:100%;">Close Editor</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const gameCanvas = document.getElementById('game');
        if (gameCanvas) {
            const preventCanvasContextMenu = function(e) {
                e.preventDefault();
            };
            gameCanvas.addEventListener('contextmenu', preventCanvasContextMenu);

            document.addEventListener('contextmenu', function(e) {
                if (e.defaultPrevented) return;
                const rect = gameCanvas.getBoundingClientRect();
                const x = e.clientX;
                const y = e.clientY;
                if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                    if (!e.target.closest('.roster-context-menu')) {
                        e.preventDefault();
                    }
                }
            }, true);
        }
    });
    </script>
    <script src="public/config.js"></script>
    <script src="main.js"></script>
    <style>
    #dev-console-fixed {
        position: fixed;
        left: 0; right: 0; bottom: 0;
        z-index: 1001;
        background: #232832ee;
        border-top: 2px solid #65c6ff;
        box-shadow: 0 -2px 16px #000a;
        padding: 0;
        display: flex;
        flex-direction: column;
        max-width: 100vw;
        min-width: 320px;
        pointer-events: auto;
    }
    #dev-console-log {
        background: #1a1e27;
        color: #e6f2ff;
        font-family: 'Fira Mono', 'Consolas', monospace;
        font-size: 1.01em;
        padding: 10px 18px 8px 18px;
        overflow-y: auto;
        white-space: pre-wrap;
        border-bottom: 1.5px solid #292f3a;
        outline: none;
        user-select: text;
        cursor: text;
        max-height: 120px;
        min-height: 38px;
    }
    #dev-console-input {
        width: 100%; font-size: 1.08em; font-family: inherit;
        background: #232832; color: #fff;
        border: 1.5px solid #65c6ff; border-radius: 7px;
        padding: 8px 12px; margin: 8px 0 8px 0;
        outline: none; box-sizing: border-box;
        transition: border 0.13s;
    }
    #dev-console-input:focus { border-color: #ffd86b; }
    #dev-console-form { margin: 0; padding: 0 18px; }
    #dev-console-fixed.hidden {
        display: none;
    }
    </style>
</body>
</html>